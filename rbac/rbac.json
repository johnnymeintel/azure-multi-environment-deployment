{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
      "roleAssignments": {
        "type": "array",
        "metadata": {
          "description": "Array of role assignments including principalId, roleDefinitionId, scope, and description"
        }
      },
      "resourceSpecificRoles": {
        "type": "array",
        "defaultValue": [],
        "metadata": {
          "description": "Array of resource-specific role assignments"
        }
      }
    },
    "resources": [
      {
        "type": "Microsoft.Authorization/roleAssignments",
        "apiVersion": "2022-04-01",
        "name": "[guid(parameters('roleAssignments')[copyIndex()].principalId, parameters('roleAssignments')[copyIndex()].roleDefinitionId, parameters('roleAssignments')[copyIndex()].scope)]",
        "properties": {
          "roleDefinitionId": "[parameters('roleAssignments')[copyIndex()].roleDefinitionId]",
          "principalId": "[parameters('roleAssignments')[copyIndex()].principalId]",
          "principalType": "Group",
          "description": "[parameters('roleAssignments')[copyIndex()].description]"
        },
        "copy": {
          "name": "roleAssignmentsCopy",
          "count": "[length(parameters('roleAssignments'))]"
        }
      },
      {
        "type": "Microsoft.Authorization/roleAssignments",
        "apiVersion": "2022-04-01",
        "name": "[guid(parameters('resourceSpecificRoles')[copyIndex()].principalId, parameters('resourceSpecificRoles')[copyIndex()].roleDefinitionId, parameters('resourceSpecificRoles')[copyIndex()].scope)]",
        "properties": {
          "roleDefinitionId": "[parameters('resourceSpecificRoles')[copyIndex()].roleDefinitionId]",
          "principalId": "[parameters('resourceSpecificRoles')[copyIndex()].principalId]",
          "principalType": "Group",
          "description": "[parameters('resourceSpecificRoles')[copyIndex()].description]"
        },
        "copy": {
          "name": "resourceRolesCopy",
          "count": "[length(parameters('resourceSpecificRoles'))]"
        }
      }
    ],
    "outputs": {
      "roleAssignmentsCount": {
        "type": "int",
        "value": "[length(parameters('roleAssignments'))]"
      },
      "resourceSpecificRolesCount": {
        "type": "int",
        "value": "[length(parameters('resourceSpecificRoles'))]"
      }
    }
  }